# ุชุฏูู ุงูุฅุญุฏุงุซูุงุช ุงูุฌุบุฑุงููุฉ (Coordinates Flow)

## ๐ ุงูููุฎุต ุงูุชูููุฐู

ุชู ุฅุถุงูุฉ ูุธุงู ูุงูู ูุงุณุชูุจุงู ูุชุฎุฒูู ูุนุฑุถ ุงูุฅุญุฏุงุซูุงุช ุงูุฌุบุฑุงููุฉ (latitude/longitude) ููุนูุงุฑุงุช ูู ุงูุฎุฑูุทุฉ ุงูุชูุงุนููุฉ ุฅูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุซู ุนุฑุถูุง ูู ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ.

---

## ๐ ุงูุชุฏูู ุงููุงูู

```
ุงููุณุชุฎุฏู ูุฎุชุงุฑ ูููุน ูู ุงูุฎุฑูุทุฉ ูู AddProperty
        โ
LocationPicker.tsx ูุฑุณู ุงูุฅุญุฏุงุซูุงุช
        โ
formData.latitude ู formData.longitude ูุชู ุชุญุฏูุซููุง
        โ
ุนูุฏ ุงูุญูุธุ ูุชู ุฅุฑุณุงู ุงูุจูุงูุงุช ุฅูู API
        โ
Django Property Model ูุญูุธ ุงูุฅุญุฏุงุซูุงุช
        โ
PropertySerializer ููุฑุฌุน ุงูุฅุญุฏุงุซูุงุช
        โ
PropertyDetails ูุฌูุจ ุงูุฅุญุฏุงุซูุงุช ูู API
        โ
PropertyMap ูุฑุณู ุงูุฎุฑูุทุฉ ูุน ุงููุคุดุฑ
```

---

## ๐ ุงูุชุญุฏูุซุงุช ุงููุทุจูุฉ

### 1๏ธโฃ ูุงุนุฏุฉ ุงูุจูุงูุงุช (Django Backend)

**ุงูููู:** `backend/listings/models.py`

```python
class Property(models.Model):
    # ... ุงูุญููู ุงูุฃุฎุฑู ...
    
    # ุงูุฅุญุฏุงุซูุงุช ุงูุฌุบุฑุงููุฉ
    latitude = models.DecimalField(max_digits=11, decimal_places=8, null=True, blank=True, verbose_name='ุฎุท ุงูุนุฑุถ')
    longitude = models.DecimalField(max_digits=11, decimal_places=8, null=True, blank=True, verbose_name='ุฎุท ุงูุทูู')
```

**ุงูููุน:** DecimalField
- **max_digits=11**: ุชุฏุนู ููู ุจุฏูุฉ ุนุงููุฉ
- **decimal_places=8**: 8 ุฃุฑูุงู ุนุดุฑูุฉ ูุฏูุฉ ุงููููุน
- **null=True, blank=True**: ุงูุญููู ุงุฎุชูุงุฑูุฉ

---

### 2๏ธโฃ API Serializer

**ุงูููู:** `backend/listings/serializers.py`

```python
class PropertySerializer(serializers.ModelSerializer):
    class Meta:
        model = Property
        fields = (
            # ... ุงูุญููู ุงูุฃุฎุฑู ...
            'latitude',      # โ ุฅุถุงูุฉ ุงูุญูู
            'longitude',     # โ ุฅุถุงูุฉ ุงูุญูู
            # ... ุงูุญููู ุงูุฃุฎุฑู ...
        )
```

---

### 3๏ธโฃ ูุงุนุฏุฉ ุงูุจูุงูุงุช (Migrations)

**ุงูููู:** `backend/listings/migrations/0026_remove_contactmessage_is_read_and_more.py`

ุชู ุชุทุจูู ุงููุฌุฑุงุช ุนูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุจูุฌุงุญ โ

---

## ๐จ Frontend Components

### 1. LocationPicker.tsx (ุงุฎุชูุงุฑ ุงููููุน)

**ุงูููู:** `src/components/LocationPicker.tsx`

```typescript
interface LocationPickerProps {
  onLocationSelect: (latitude: number, longitude: number) => void;
  latitude?: number | string;
  longitude?: number | string;
}
```

**ุงููููุฒุงุช:**
- ๐บ๏ธ ุฎุฑูุทุฉ ุชูุงุนููุฉ (Leaflet)
- ๐ ุฅุถุงูุฉ ูุคุดุฑ ุจุงูููุฑ ุนูู ุงูุฎุฑูุทุฉ
- ๐ฑ๏ธ ุณุญุจ ุงููุคุดุฑ ูุชุญุฏูุซ ุงููููุน
- ๐ฏ ุญูุธ ุงูุฅุญุฏุงุซูุงุช ุนูุฏ ูู ุชุบููุฑ

---

### 2. AddProperty.tsx (ุฅุถุงูุฉ ุนูุงุฑ)

**ุงูููู:** `src/pages/dashboard/AddProperty.tsx`

```typescript
const handleLocationSelect = (latitude: number, longitude: number) => {
  setFormData((prev) => ({
    ...prev,
    latitude: latitude.toString(),
    longitude: longitude.toString(),
  }));
};
```

**ุงูุจูุงูุงุช ุงููุฑุณูุฉ:**
```javascript
{
  name: "ุงุณู ุงูุนูุงุฑ",
  area: 1,
  address: "ุงูุนููุงู",
  price: 5000,
  // ... ุจุงูู ุงูุจูุงูุงุช ...
  latitude: "31.2054",    // โ ูู ุงูุฎุฑูุทุฉ
  longitude: "29.9187"    // โ ูู ุงูุฎุฑูุทุฉ
}
```

---

### 3. PropertyDetails.tsx (ุนุฑุถ ุงูุชูุงุตูู)

**ุงูููู:** `src/pages/PropertyDetails.tsx`

```typescript
<PropertyMap 
  latitude={(property as any).latitude}      // โ ูู API
  longitude={(property as any).longitude}    // โ ูู API
  propertyName={property.name}
  address={property.address}
  height="350px"
/>
```

---

### 4. PropertyMap.tsx (ุนุฑุถ ุงูุฎุฑูุทุฉ)

**ุงูููู:** `src/components/PropertyMap.tsx`

```typescript
interface PropertyMapProps {
  latitude?: number | string;
  longitude?: number | string;
  propertyName?: string;
  address?: string;
}
```

**ุงููููุฒุงุช:**
- ๐บ๏ธ ุนุฑุถ ุฎุฑูุทุฉ ุจุงููููุน ุงููุญุฏุฏ
- ๐ ุนูุงูุฉ ูุน ูุนูููุงุช ุงูุนูุงุฑ
- ๐ ุฅููุงููุฉ ุงูุชูุจูุฑ ูุงูุชุตุบูุฑ
- ๐ ุนุฑุถ ุงูุฅุญุฏุงุซูุงุช ุจุฏูุฉ

---

## ๐ API Endpoints

### POST /api/properties/

**ุงูุทูุจ:**
```json
{
  "name": "ุนูุงุฑ ุชุฌุฑูุจู",
  "area": 1,
  "address": "ุดุงุฑุน ุงููููุ ุงููุงูุฑุฉ",
  "price": "5000.00",
  "rooms": "3",
  "beds": "2",
  "bathrooms": "2",
  "size": "150",
  "floor": "2",
  "furnished": true,
  "usage_type": "families",
  "description": "ุนูุงุฑ ุนุงุฆูู",
  "contact": "01012345678",
  "latitude": "31.2054",    // โ ูู ุงูุฎุฑูุทุฉ
  "longitude": "29.9187"    // โ ูู ุงูุฎุฑูุทุฉ
}
```

**ุงูุงุณุชุฌุงุจุฉ:**
```json
{
  "id": "uuid-here",
  "name": "ุนูุงุฑ ุชุฌุฑูุจู",
  // ... ุงูุจูุงูุงุช ุงูุฃุฎุฑู ...
  "latitude": "31.20540000",  // โ ูุญููุธุฉ
  "longitude": "29.91870000", // โ ูุญููุธุฉ
}
```

### GET /api/properties/{id}/

**ุงูุงุณุชุฌุงุจุฉ:**
```json
{
  "id": "uuid-here",
  "name": "ุนูุงุฑ ุชุฌุฑูุจู",
  // ... ุงูุจูุงูุงุช ุงูุฃุฎุฑู ...
  "latitude": "31.20540000",  // โ ุชูุฑุฌุน ุงูุฅุญุฏุงุซูุงุช
  "longitude": "29.91870000", // โ ุชูุฑุฌุน ุงูุฅุญุฏุงุซูุงุช
}
```

---

## โ ูุงุฆูุฉ ุงูุชุญูู

### Backend
- โ ุฅุถุงูุฉ ุญููู `latitude` ู `longitude` ุฅูู ูููุฐุฌ Property
- โ ุฅุถุงูุฉ ุงูุญููู ุฅูู PropertySerializer
- โ ุฅูุดุงุก ููู ุงููุฌุฑุฉ (0026_remove_contactmessage_is_read_and_more.py)
- โ ุชุทุจูู ุงููุฌุฑุงุช ุนูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- โ ุชุญุฏูุซ admin.py ูุญู ูุดุงูู ContactMessage

### Frontend
- โ LocationPicker.tsx ูุฑุณู ุงูุฅุญุฏุงุซูุงุช
- โ AddProperty.tsx ูุญูุธ ุงูุฅุญุฏุงุซูุงุช ูู formData
- โ ุงูุฅุญุฏุงุซูุงุช ุชูุฑุณู ูู ุทูุจ POST ุฅูู API
- โ PropertyDetails ูุนุฑุถ PropertyMap
- โ PropertyMap ูุณุชูุจู ุงูุฅุญุฏุงุซูุงุช ููุฑุณู ุงูุฎุฑูุทุฉ

---

## ๐งช ุงุฎุชุจุงุฑ ุงููุธุงู

### 1. ุฅุถุงูุฉ ุนูุงุฑ ุฌุฏูุฏ
1. ุงุฐูุจ ุฅูู ุตูุญุฉ "ุฅุถุงูุฉ ุนูุงุฑ"
2. ููุก ุฌููุน ุงูุญููู ุงููุทููุจุฉ
3. ุงููุฑ ุนูู ุงูุฎุฑูุทุฉ ูุงุฎุชูุงุฑ ุงููููุน
4. ูุงุญุธ ุฃู ุงูุฅุญุฏุงุซูุงุช ุชุชุญุฏุซ ุชููุงุฆูุงู
5. ุงุญูุธ ุงูุนูุงุฑ

### 2. ุนุฑุถ ุงูุนูุงุฑ
1. ุงุฐูุจ ุฅูู ูุงุฆูุฉ ุงูุนูุงุฑุงุช
2. ุงูุชุญ ุงูุนูุงุฑ ุงูุฐู ุฃุถูุชู
3. ูุฌุจ ุฃู ุชุฑู ุงูุฎุฑูุทุฉ ูุน ุงููุคุดุฑ ุนูู ุงููููุน ุงูุตุญูุญ

### 3. ุงูุชุญูู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
```bash
cd backend
python manage.py shell

from listings.models import Property
prop = Property.objects.latest('created_at')
print(f"Latitude: {prop.latitude}")    # ูุฌุจ ุฃู ูููู ูููุฉ
print(f"Longitude: {prop.longitude}")  # ูุฌุจ ุฃู ูููู ูููุฉ
```

---

## ๐ ุฃูุซูุฉ ุนูู ุงูุฅุญุฏุงุซูุงุช

| ุงููููุน | Latitude | Longitude |
|--------|----------|-----------|
| ุงููุงูุฑุฉ | 30.0444 | 31.2357 |
| ุงูุฌูุฒุฉ | 30.0131 | 31.2089 |
| ุงูุฅุณููุฏุฑูุฉ | 31.2001 | 29.9187 |
| ุจูู ุณููู | 29.0664 | 31.2991 |
| ุงููููู | 29.3084 | 30.8429 |

---

## ๐ ุงูุญููู ูุงูุฃูุงู

- ุงูุญููู ุงุฎุชูุงุฑูุฉ (null=True, blank=True)
- ูุง ุชูุฌุฏ ูููุฏ ุนูู ุงูุฅุญุฏุงุซูุงุช
- ูููู ุชุญุฏูุซ ุงูุฅุญุฏุงุซูุงุช ูุงุญูุงู ูู ูุจู ุงูุฅุฏูู
- ุงูุฎุฑูุทุฉ ุชุนูู ุจุฏูู ุงูุฅุญุฏุงุซูุงุช (ุชุธูุฑ ุฑุณุงูุฉ ุฎุทุฃ ูุฏูุฉ)

---

## ๐ ููุงุญุธุงุช ุฅุถุงููุฉ

### ููุน ุงูุจูุงูุงุช
ุงุณุชุฎุฏููุง `DecimalField` ุจุฏูุงู ูู `FloatField` ูุฃู:
- ุงูุฏูุฉ ุงูุนุงููุฉ ุงููุทููุจุฉ ููุฅุญุฏุงุซูุงุช
- ุชุฌูุจ ูุดุงูู ุฏูุฉ ุงููุงุตูุฉ ุงูุนุงุฆูุฉ
- ุชูุงูู ุฃูุถู ูุน ููุงุนุฏ ุงูุจูุงูุงุช ุงููุฎุชููุฉ

### ุนูู ุงูุชูุงุตูู
- 8 ุฃุฑูุงู ุนุดุฑูุฉ = ุฏูุฉ ุญูุงูู 1.1 ููููุชุฑ
- ููุงุณุจ ุฌุฏุงู ูุชุทุจููุงุช ุงูุนูุงุฑุงุช

### ุงูุชูุงูููุฉ
- ูุนูู ูุน ุฌููุน ุงููุชุตูุญุงุช ุงูุญุฏูุซุฉ
- ูุนูู ูุน Leaflet JS
- ูุนูู ูุน API ุงููุฏููุฉ (ุงูุฅุญุฏุงุซูุงุช ุงุฎุชูุงุฑูุฉ)

---

## ๐ ุงููููุฒุงุช ุงููุณุชูุจููุฉ

1. **Half Radius Search**: ุงูุจุญุซ ุนู ุงูุนูุงุฑุงุช ุจูุตู ูุทุฑ ูุนูู
2. **Location History**: ุญูุธ ุขุฎุฑ ุงูุฅุญุฏุงุซูุงุช ุงููุณุชุฎุฏูุฉ
3. **Reverse Geocoding**: ุชุญููู ุงูุฅุญุฏุงุซูุงุช ุฅูู ุนูุงููู
4. **Multiple Markers**: ุนุฑุถ ุนุฏุฉ ุนูุงุฑุงุช ุนูู ููุณ ุงูุฎุฑูุทุฉ
5. **Street View**: ุนุฑุถ ุตูุฑ ุฌูุฌู ุณุชุฑูุช ููู

---

**ุงูุชุงุฑูุฎ:** 24 ููุงูุฑ 2026
**ุงูุญุงูุฉ:** โ ุฌุงูุฒ ููุงุณุชุฎุฏุงู
