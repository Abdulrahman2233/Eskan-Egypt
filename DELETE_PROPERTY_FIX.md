# ุฅุตูุงุญ ูุดููุฉ ุญุฐู ุงูุนูุงุฑุงุช ุงููุนููุฉ ูุงููุฑููุถุฉ

## ๐ด ุงููุดููุฉ ุงูุฃุณุงุณูุฉ
ุนูุฏ ูุญุงููุฉ ุญุฐู ุนูุงุฑ ูุนูู (pending) ุฃู ูุฑููุถ (rejected) ูู ููุญุฉ ุงูุชุญููุ ูุญุฏุซ ุฑุณุงูุฉ ุฎุทุฃ. ููู ุญุฐู ุงูุนูุงุฑ ุงููุนุชูุฏ (approved) ูุนูู ุจุดูู ุทุจูุนู.

## ๐ด ุงููุดููุฉ ุงูุซุงูููุฉ
ุจุนุฏ ุงูุฅุตูุงุญ ุงูุฃููุ ุธูุฑุช ูุดููุฉ ุฃู ุงูุนูุงุฑุงุช ุบูุฑ ุงููุนุชูุฏุฉ ุชุธูุฑ ูู ูุงุฆูุฉ ุงูุนูุงุฑุงุช ุงูุนุงูุฉ ูููุณุชุฎุฏู.

## ๐ ุงูุณุจุจ ุงูุฌุฐุฑู
ุงููุดููุฉ ุงูุฃุณุงุณูุฉ ูุงูุช ูู ุฏุงูุฉ `get_queryset()` ูู `PropertyViewSet`:

### ุงููุดููุฉ ุงูุฃููู:
```python
# ุงูููุฏ ุงููุฏูู - ุฎุงุทุฆ
elif self.request.user.is_authenticated:
    queryset = Property.objects.filter(status='approved')  # โ ูุตูู ููุท ุงูุนูุงุฑุงุช ุงููุนุชูุฏุฉ
```

ุนูุฏูุง ูุญุงูู ุงููุณุชุฎุฏู ุงูุนุงุฏู (landlord) ุงููุตูู ุฅูู ุนูุงุฑู ุงููุนูู ุฃู ุงููุฑููุถุ ูุง ูุฌุฏ ุงูุนูุงุฑ ูู `queryset` ูุฃููุง ุชุตูู ุงูุนูุงุฑุงุช ุญุณุจ ุงูุญุงูุฉ ููุท. ูุจุงูุชุงูู ุนูุฏ ูุญุงููุฉ ุงูุญุฐูุ ูุญุตู ุนูู ุฎุทุฃ `404 Not Found`.

### ุงููุดููุฉ ุงูุซุงููุฉ:
ุนุฏู ูุฌูุฏ ูุนุงูุฌ ุตุฑูุญ ูู `destroy()` ูุชุญูู ูู ุงูุตูุงุญูุงุช ุจุดูู ุตุญูุญ.

### ุงููุดููุฉ ุงูุซุงูุซุฉ (ุจุนุฏ ุงูุฅุตูุงุญ ุงูุฃูู):
ุงูุฅุตูุงุญ ุงูุฃูู ุณูุญ ุจูุดุงูุฏุฉ ุนูุงุฑุงุช ุงููุณุชุฎุฏู ุบูุฑ ุงููุนุชูุฏุฉ ูู ุงููุงุฆูุฉ ุงูุนุงูุฉุ ููุง ููุณ ูุฑุบูุจุงู.

## โ ุงูุญู ุงููุทุจู (ุงููุณุฎุฉ ุงูููุงุฆูุฉ)

### 1. ุชุญุฏูุซ `get_queryset()` ูุน ุงูุชูุฑูู ุจูู ุงูุทูุจุงุช
```python
def get_queryset(self):
    # ุงูุชูุฑูู ุจูู ุทูุจ ูุงุฆูุฉ (list) ูุทูุจ ุนูุงุฑ ูุญุฏุฏ (detail)
    is_detail_request = self.action in ['retrieve', 'destroy', 'update', 'partial_update', 'approve', 'reject', 'resubmit']
    
    if self.request.user.is_authenticated:
        user_profile = self.request.user.profile if hasattr(self.request.user, 'profile') else None
        
        if is_detail_request:
            # ุนูุฏ ุงููุตูู ุฅูู ุนูุงุฑ ูุญุฏุฏ: ููููู ุงููุตูู ุฅูู ุนูุงุฑู ุงูุฎุงุต ุฃู ุงูุนูุงุฑุงุช ุงููุนุชูุฏุฉ
            queryset = Property.objects.filter(
                Q(status='approved') | Q(owner=user_profile)
            )
        else:
            # ูู ูุงุฆูุฉ ุงูุนูุงุฑุงุช: ูุฑู ููุท ุงูุนูุงุฑุงุช ุงููุนุชูุฏุฉ
            queryset = Property.objects.filter(status='approved')
```

**ุงูููุทู:**
- โ **ูู ูุงุฆูุฉ ุงูุนูุงุฑุงุช ุงูุนุงูุฉ:** ูุฑู ููุท ุงูุนูุงุฑุงุช ุงููุนุชูุฏุฉ
- โ **ุนูุฏ ุงููุตูู ูุนูุงุฑ ูุญุฏุฏ (ููุญุฐู ุฃู ุงูุชุนุฏูู):** ูุณุชุทูุน ุงููุตูู ุฅูู ุนูุงุฑู ุงูุฎุงุต ุจุฌููุน ุงูุญุงูุงุช
- โ **ูู ููุญุฉ ุงูุชุญูู ุงูุฅุฏุงุฑูุฉ:** ูุฑู ุฌููุน ุงูุนูุงุฑุงุช ุจุฌููุน ุงูุญุงูุงุช

### 2. ุฅุถุงูุฉ ูุนุงูุฌ `destroy()` ุตุฑูุญ
```python
def destroy(self, request, *args, **kwargs):
    """ุญุฐู ุนูุงุฑ - ูููู ูููุงูู ูุงูุฅุฏูู ููุท"""
    instance = self.get_object()
    user_profile = request.user.profile if hasattr(request.user, 'profile') else None
    
    # ุงูุชุญูู ูู ุงูุตูุงุญูุงุช:
    # - ุงูุฅุฏูู ููููู ุญุฐู ุฃู ุนูุงุฑ
    # - ุตุงุญุจ ุงูุนูุงุฑ ููููู ุญุฐู ุนูุงุฑู ุงูุฎุงุต ููุท
    is_admin = request.user.is_staff or request.user.is_superuser
    is_owner = user_profile and instance.owner == user_profile
    
    if not (is_admin or is_owner):
        return Response(
            {'detail': 'ููุณ ูุฏูู ุตูุงุญูุฉ ุญุฐู ูุฐุง ุงูุนูุงุฑ'},
            status=status.HTTP_403_FORBIDDEN
        )
    
    # ุญุฐู ุงูุนูุงุฑ
    self.perform_destroy(instance)
    return Response(
        {'detail': 'ุชู ุญุฐู ุงูุนูุงุฑ ุจูุฌุงุญ'},
        status=status.HTTP_204_NO_CONTENT
    )
```

### 3. ุฅุถุงูุฉ import ููู Q object
```python
from django.db.models import Q
```

## ๐งช ุงูุงุฎุชุจุงุฑ ูุงููุชุงุฆุฌ

### โ ูู ุงููุงุฌูุฉ ุงูุนุงูุฉ (ูุงุฆูุฉ ุงูุนูุงุฑุงุช):
- ุงููุณุชุฎุฏู ูุฑู ููุท ุงูุนูุงุฑุงุช **ุงููุนุชูุฏุฉ** ูู ุงูุฌููุน
- ุงูุนูุงุฑุงุช ุงููุนููุฉ ูุงููุฑููุถุฉ **ูุง ุชุธูุฑ** ูู ุงููุงุฆูุฉ

### โ ูู ููุญุฉ ุงูุชุญูู ุงูุดุฎุตูุฉ:
- ุงููุณุชุฎุฏู ูุณุชุทูุน **ุญุฐู** ุนูุงุฑู ุงููุนูู
- ุงููุณุชุฎุฏู ูุณุชุทูุน **ุญุฐู** ุนูุงุฑู ุงููุฑููุถ
- ุงููุณุชุฎุฏู ูุณุชุทูุน **ุญุฐู** ุนูุงุฑู ุงููุนุชูุฏ
- ุฌููุน ุงูุนูููุงุช **ุขููุฉ** (ุงูุชุญูู ูู ุงูููููุฉ)

### โ ูู ููุญุฉ ุงูุชุญูู ุงูุฅุฏุงุฑูุฉ:
- ุงูุฅุฏูู ูุฑู ุฌููุน ุงูุนูุงุฑุงุช ุจุฌููุน ุงูุญุงูุงุช
- ุงูุฅุฏูู ูุณุชุทูุน ุญุฐู ุฃู ุนูุงุฑ
- ุงูุฅุฏูู ูุณุชุทูุน ุงูููุงููุฉ ุฃู ุงูุฑูุถ

## ๐ ุงููููุงุช ุงููุนุฏูุฉ
- `backend/listings/views.py`
  - ุฃุถููุง `from django.db.models import Q` ููู imports
  - ุนุฏููุง `get_queryset()` ููุชูุฑูู ุจูู ุทูุจุงุช ุงููุงุฆูุฉ ูุทูุจุงุช ุงูุชูุงุตูู
  - ุฃุถููุง ูุนุงูุฌ `destroy()` ุตุฑูุญ ููุชุญูู ูู ุงูุตูุงุญูุงุช

## ๐ ููุงุญุธุงุช ุงูุฃูุงู
โ **ุงููุณุชุฎุฏู ุงูุนุงุฏู:**
- ูุณุชุทูุน ุญุฐู ุนูุงุฑู ููุท
- ูุฑู ููุท ุงูุนูุงุฑุงุช ุงููุนุชูุฏุฉ ูู ุงููุงุฆูุฉ ุงูุนุงูุฉ
- ูุณุชุทูุน ุงููุตูู ูุนูุงุฑู ุงูุฎุงุต (ูุนูู/ูุฑููุถ) ููุญุฐู

โ **ุงูุฅุฏูู:**
- ูุณุชุทูุน ุญุฐู ุฃู ุนูุงุฑ
- ูุฑู ุฌููุน ุงูุนูุงุฑุงุช ุจุฌููุน ุงูุญุงูุงุช

โ **ุฌููุน ุนูููุงุช ุงูุญุฐู:**
- ุชูุณุฌู ูู ุณุฌู ุงููุดุงุทุงุช (ActivityLog) ุนุจุฑ signal `post_delete`

